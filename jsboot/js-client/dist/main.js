!function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=35)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JsonSerializers=t.JsonSerializer=t.IdentitySerializers=t.IdentitySerializer=t.UTF8Encoder=t.Utf8Encoders=t.BufferEncoder=t.BufferEncoders=t.writeUInt24BE=t.toBuffer=t.readUInt24BE=t.createBuffer=t.byteLength=t.serializeFrameWithLength=t.serializeFrame=t.deserializeFrames=t.deserializeFrameWithLength=t.deserializeFrame=t.printFrame=t.isResumeEnable=t.isRespond=t.isNext=t.isMetadata=t.isLease=t.isIgnore=t.isComplete=t.getErrorCodeExplanation=t.createErrorFromFrame=t.MAX_VERSION=t.MAX_STREAM_ID=t.MAX_RESUME_LENGTH=t.MAX_MIME_LENGTH=t.MAX_LIFETIME=t.MAX_KEEPALIVE=t.MAX_CODE=t.FRAME_TYPES=t.FRAME_TYPE_OFFFSET=t.FLAGS=t.FLAGS_MASK=t.ERROR_EXPLANATIONS=t.ERROR_CODES=t.CONNECTION_STREAM_ID=t.RSocketResumableTransport=t.RSocketServer=t.RSocketClient=void 0;var n=r(2);Object.defineProperty(t,"CONNECTION_STREAM_ID",{enumerable:!0,get:function(){return n.CONNECTION_STREAM_ID}}),Object.defineProperty(t,"ERROR_CODES",{enumerable:!0,get:function(){return n.ERROR_CODES}}),Object.defineProperty(t,"ERROR_EXPLANATIONS",{enumerable:!0,get:function(){return n.ERROR_EXPLANATIONS}}),Object.defineProperty(t,"FLAGS_MASK",{enumerable:!0,get:function(){return n.FLAGS_MASK}}),Object.defineProperty(t,"FLAGS",{enumerable:!0,get:function(){return n.FLAGS}}),Object.defineProperty(t,"FRAME_TYPE_OFFFSET",{enumerable:!0,get:function(){return n.FRAME_TYPE_OFFFSET}}),Object.defineProperty(t,"FRAME_TYPES",{enumerable:!0,get:function(){return n.FRAME_TYPES}}),Object.defineProperty(t,"MAX_CODE",{enumerable:!0,get:function(){return n.MAX_CODE}}),Object.defineProperty(t,"MAX_KEEPALIVE",{enumerable:!0,get:function(){return n.MAX_KEEPALIVE}}),Object.defineProperty(t,"MAX_LIFETIME",{enumerable:!0,get:function(){return n.MAX_LIFETIME}}),Object.defineProperty(t,"MAX_MIME_LENGTH",{enumerable:!0,get:function(){return n.MAX_MIME_LENGTH}}),Object.defineProperty(t,"MAX_RESUME_LENGTH",{enumerable:!0,get:function(){return n.MAX_RESUME_LENGTH}}),Object.defineProperty(t,"MAX_STREAM_ID",{enumerable:!0,get:function(){return n.MAX_STREAM_ID}}),Object.defineProperty(t,"MAX_VERSION",{enumerable:!0,get:function(){return n.MAX_VERSION}}),Object.defineProperty(t,"createErrorFromFrame",{enumerable:!0,get:function(){return n.createErrorFromFrame}}),Object.defineProperty(t,"getErrorCodeExplanation",{enumerable:!0,get:function(){return n.getErrorCodeExplanation}}),Object.defineProperty(t,"isComplete",{enumerable:!0,get:function(){return n.isComplete}}),Object.defineProperty(t,"isIgnore",{enumerable:!0,get:function(){return n.isIgnore}}),Object.defineProperty(t,"isLease",{enumerable:!0,get:function(){return n.isLease}}),Object.defineProperty(t,"isMetadata",{enumerable:!0,get:function(){return n.isMetadata}}),Object.defineProperty(t,"isNext",{enumerable:!0,get:function(){return n.isNext}}),Object.defineProperty(t,"isRespond",{enumerable:!0,get:function(){return n.isRespond}}),Object.defineProperty(t,"isResumeEnable",{enumerable:!0,get:function(){return n.isResumeEnable}}),Object.defineProperty(t,"printFrame",{enumerable:!0,get:function(){return n.printFrame}});var s=r(18);Object.defineProperty(t,"deserializeFrame",{enumerable:!0,get:function(){return s.deserializeFrame}}),Object.defineProperty(t,"deserializeFrameWithLength",{enumerable:!0,get:function(){return s.deserializeFrameWithLength}}),Object.defineProperty(t,"deserializeFrames",{enumerable:!0,get:function(){return s.deserializeFrames}}),Object.defineProperty(t,"serializeFrame",{enumerable:!0,get:function(){return s.serializeFrame}}),Object.defineProperty(t,"serializeFrameWithLength",{enumerable:!0,get:function(){return s.serializeFrameWithLength}});var i=r(6);Object.defineProperty(t,"byteLength",{enumerable:!0,get:function(){return i.byteLength}}),Object.defineProperty(t,"createBuffer",{enumerable:!0,get:function(){return i.createBuffer}}),Object.defineProperty(t,"readUInt24BE",{enumerable:!0,get:function(){return i.readUInt24BE}}),Object.defineProperty(t,"toBuffer",{enumerable:!0,get:function(){return i.toBuffer}}),Object.defineProperty(t,"writeUInt24BE",{enumerable:!0,get:function(){return i.writeUInt24BE}});var o=r(8);Object.defineProperty(t,"BufferEncoders",{enumerable:!0,get:function(){return o.BufferEncoders}}),Object.defineProperty(t,"BufferEncoder",{enumerable:!0,get:function(){return o.BufferEncoder}}),Object.defineProperty(t,"Utf8Encoders",{enumerable:!0,get:function(){return o.Utf8Encoders}}),Object.defineProperty(t,"UTF8Encoder",{enumerable:!0,get:function(){return o.UTF8Encoder}});var a=r(7);Object.defineProperty(t,"IdentitySerializer",{enumerable:!0,get:function(){return a.IdentitySerializer}}),Object.defineProperty(t,"IdentitySerializers",{enumerable:!0,get:function(){return a.IdentitySerializers}}),Object.defineProperty(t,"JsonSerializer",{enumerable:!0,get:function(){return a.JsonSerializer}}),Object.defineProperty(t,"JsonSerializers",{enumerable:!0,get:function(){return a.JsonSerializers}});var u=f(r(23)),c=f(r(30)),l=f(r(31));function f(e){return e&&e.__esModule?e:{default:e}}t.RSocketClient=u.default,t.RSocketServer=c.default,t.RSocketResumableTransport=l.default},function(e,t,r){"use strict";var n=function(e){};e.exports=function(e,t,r,s,i,o,a,u){if(n(t),!e){var c;if(void 0===t)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var l=[r,s,i,o,a,u],f=0;(c=new Error(t.replace(/%s/g,(function(){return l[f++]})))).name="Invariant Violation"}throw c.framesToPop=1,c}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_VERSION=t.MAX_TTL=t.MAX_STREAM_ID=t.MAX_RESUME_LENGTH=t.MAX_REQUEST_N=t.MAX_REQUEST_COUNT=t.MAX_MIME_LENGTH=t.MAX_METADATA_LENGTH=t.MAX_LIFETIME=t.MAX_KEEPALIVE=t.MAX_CODE=t.FRAME_TYPE_OFFFSET=t.FLAGS_MASK=t.ERROR_EXPLANATIONS=t.ERROR_CODES=t.FLAGS=t.FRAME_TYPE_NAMES=t.FRAME_TYPES=t.CONNECTION_STREAM_ID=void 0,t.isIgnore=function(e){return(e&u.IGNORE)===u.IGNORE},t.isMetadata=function(e){return(e&u.METADATA)===u.METADATA},t.isComplete=function(e){return(e&u.COMPLETE)===u.COMPLETE},t.isNext=function(e){return(e&u.NEXT)===u.NEXT},t.isRespond=function(e){return(e&u.RESPOND)===u.RESPOND},t.isResumeEnable=function(e){return(e&u.RESUME_ENABLE)===u.RESUME_ENABLE},t.isLease=function(e){return(e&u.LEASE)===u.LEASE},t.isResumePositionFrameType=function(e){return e===o.CANCEL||e===o.ERROR||e===o.METADATA_PUSH||e===o.PAYLOAD||e===o.REQUEST_CHANNEL||e===o.REQUEST_FNF||e===o.REQUEST_RESPONSE||e===o.REQUEST_STREAM},t.getFrameTypeName=f,t.createErrorFromFrame=function(e){const{code:t,message:r}=e,n=h(t),i=new Error((0,s.default)("RSocket error %s (%s): %s. See error `source` property for details.",d(t),n,r));return i.source={code:t,explanation:n,message:r},i},t.getErrorCodeExplanation=h,t.printFrame=function(e){const t=Object.assign({},e);t.type=f(e.type)+` (${d(e.type)})`;const r=[];(0,n.default)(u,(t,n)=>{(e.flags&t)===t&&r.push(n)}),r.length||r.push("NO FLAGS");t.flags=r.join(" | ")+` (${d(e.flags)})`,e.type===o.ERROR&&(t.code=h(e.code)+` (${d(e.code)})`);return JSON.stringify(t,null,2)};var n=i(r(16)),s=i(r(17));function i(e){return e&&e.__esModule?e:{default:e}}t.CONNECTION_STREAM_ID=0;const o=t.FRAME_TYPES={CANCEL:9,ERROR:11,EXT:63,KEEPALIVE:3,LEASE:2,METADATA_PUSH:12,PAYLOAD:10,REQUEST_CHANNEL:7,REQUEST_FNF:5,REQUEST_N:8,REQUEST_RESPONSE:4,REQUEST_STREAM:6,RESERVED:0,RESUME:13,RESUME_OK:14,SETUP:1},a=t.FRAME_TYPE_NAMES={};(0,n.default)(o,(e,t)=>{a[e]=t});const u=t.FLAGS={COMPLETE:64,FOLLOWS:128,IGNORE:512,LEASE:64,METADATA:256,NEXT:32,RESPOND:128,RESUME_ENABLE:128},c=t.ERROR_CODES={APPLICATION_ERROR:513,CANCELED:515,CONNECTION_CLOSE:258,CONNECTION_ERROR:257,INVALID:516,INVALID_SETUP:1,REJECTED:514,REJECTED_RESUME:4,REJECTED_SETUP:3,RESERVED:0,RESERVED_EXTENSION:4294967295,UNSUPPORTED_SETUP:2},l=t.ERROR_EXPLANATIONS={};(0,n.default)(c,(e,t)=>{l[e]=t});t.FLAGS_MASK=1023,t.FRAME_TYPE_OFFFSET=10,t.MAX_CODE=2147483647,t.MAX_KEEPALIVE=2147483647,t.MAX_LIFETIME=2147483647,t.MAX_METADATA_LENGTH=16777215,t.MAX_MIME_LENGTH=255,t.MAX_REQUEST_COUNT=2147483647,t.MAX_REQUEST_N=2147483647,t.MAX_RESUME_LENGTH=65535,t.MAX_STREAM_ID=2147483647,t.MAX_TTL=2147483647,t.MAX_VERSION=65535;function f(e){const t=a[e];return null!=t?t:d(e)}function h(e){const t=l[e];return null!=t?t:e<=768?"RESERVED (PROTOCOL)":"RESERVED (APPLICATION)"}function d(e){return"0x"+e.toString(16)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.every=t.Single=t.FlowableProcessor=t.Flowable=void 0;var n=a(r(11)),s=a(r(26)),i=a(r(27)),o=r(28);function a(e){return e&&e.__esModule?e:{default:e}}t.Flowable=n.default,t.FlowableProcessor=i.default,t.Single=s.default,t.every=o.every},function(e,t,r){"use strict";var n=r(5);e.exports=n},function(e,t,r){"use strict";function n(e){return function(){return e}}var s=function(){};s.thatReturns=n,s.thatReturnsFalse=n(!1),s.thatReturnsTrue=n(!0),s.thatReturnsNull=n(null),s.thatReturnsThis=function(){return this},s.thatReturnsArgument=function(e){return e},e.exports=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createBuffer=void 0,t.readUInt24BE=function(e,t){const r=e.readUInt8(t)<<16,n=e.readUInt8(t+1)<<8,s=e.readUInt8(t+2);return r|n|s},t.writeUInt24BE=function(e,t,r){return r=e.writeUInt8(t>>>16,r),r=e.writeUInt8(t>>>8&255,r),e.writeUInt8(255&t,r)},t.readUInt64BE=function(e,t){const r=e.readUInt32BE(t),n=e.readUInt32BE(t+4);return r*a+n},t.writeUInt64BE=function(e,t,r){const n=t/a|0,s=t%a;return r=e.writeUInt32BE(n,r),e.writeUInt32BE(s,r)},t.byteLength=function(e,t){if(null==e)return 0;return s.LiteBuffer.byteLength(e,t)},t.toBuffer=function(e){if(e instanceof s.LiteBuffer)return e;return(0,o.default)(e instanceof ArrayBuffer,"RSocketBufferUtils: Cannot construct buffer. Expected data to be an arraybuffer, got `%s`.",e),s.LiteBuffer.from(e)};var n,s=r(10),i=r(1),o=(n=i)&&n.__esModule?n:{default:n};const a=4294967296;t.createBuffer="function"==typeof s.LiteBuffer.alloc?e=>s.LiteBuffer.alloc(e):e=>new s.LiteBuffer(e).fill(0)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IdentitySerializers=t.IdentitySerializer=t.JsonSerializers=t.JsonSerializer=void 0;var n,s=r(10),i=r(1),o=(n=i)&&n.__esModule?n:{default:n};const a=t.JsonSerializer={deserialize:e=>{let t;if(null==e)return null;if("string"==typeof e)t=e;else if(s.LiteBuffer.isBuffer(e)){t=e.toString("utf8")}else{t=s.LiteBuffer.from(e).toString("utf8")}return JSON.parse(t)},serialize:JSON.stringify},u=(t.JsonSerializers={data:a,metadata:a},t.IdentitySerializer={deserialize:e=>((0,o.default)(null==e||"string"==typeof e||s.LiteBuffer.isBuffer(e)||e instanceof Uint8Array,"RSocketSerialization: Expected data to be a string, Buffer, or Uint8Array. Got `%s`.",e),e),serialize:e=>e});t.IdentitySerializers={data:u,metadata:u}},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.BufferEncoders=t.Utf8Encoders=t.BufferEncoder=t.UTF8Encoder=void 0;var n,s=r(6),i=r(1),o=(n=i)&&n.__esModule?n:{default:n};const a=t.UTF8Encoder={byteLength:e=>(0,s.byteLength)(e,"utf8"),decode:(e,t,r)=>e.toString("utf8",t,r),encode:(e,t,r,n)=>((0,o.default)("string"==typeof e,"RSocketEncoding: Expected value to be a string, got `%s`.",e),t.write(e,r,n-r,"utf8"),n)},u=t.BufferEncoder={byteLength:t=>((0,o.default)(e.isBuffer(t),"RSocketEncoding: Expected value to be a buffer, got `%s`.",t),t.length),decode:(e,t,r)=>e.slice(t,r),encode:(t,r,n,s)=>((0,o.default)(e.isBuffer(t),"RSocketEncoding: Expected value to be a buffer, got `%s`.",t),t.copy(r,n,0,t.length),s)};t.Utf8Encoders={data:a,dataMimeType:a,message:a,metadata:a,metadataMimeType:a,resumeToken:a},t.BufferEncoders={data:u,dataMimeType:a,message:a,metadata:u,metadataMimeType:a,resumeToken:u}}).call(this,r(19).Buffer)},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.Buffer=i;const r=2147483647;function n(e){if(e>r)throw new RangeError('The value "'+e+'" is invalid for option "size"');let t=new Uint8Array(e);return t.__proto__=i.prototype,t}const s=void 0!==e&&e.hasOwnProperty("Buffer");t.LiteBuffer=s?e.Buffer:i;function i(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return a(s=e),n(s<0?0:0|c(s))}var s;return o(e,t,r)}function o(e,t,r){if(ArrayBuffer.isView(e))return u(e);if(null==e)throw TypeError("The first argument must be one of type, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(p(e,ArrayBuffer)||e&&p(e.buffer,ArrayBuffer))return function(e,t,r){let n;n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r);return n.__proto__=i.prototype,n}(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');let s=e.valueOf&&e.valueOf();if(null!=s&&s!==e)return i.from(s,t,r);let o=function(e){if(i.isBuffer(e)){let t=0|c(e.length),r=n(t);return 0===r.length?r:(e.copy(r,0,0,t),r)}if(void 0!==e.length)return"number"!=typeof e.length||function(e){return e!=e}(e.length)?n(0):u(e);if("Buffer"===e.type&&Array.isArray(e.data))return u(e.data)}(e);if(o)return o;throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function a(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function u(e){let t=e.length<0?0:0|c(e.length),r=n(t);for(let n=0;n<t;n+=1)r[n]=255&e[n];return r}function c(e){if(e>=r)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r.toString(16)+" bytes");return 0|e}i.from=function(e,t,r){return o(e,t,r)},i.prototype.__proto__=Uint8Array.prototype,i.__proto__=Uint8Array,i.alloc=function(e,t,r){return function(e,t,r){return a(e),n(e)}(e)},i.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==i.prototype},i.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},i.prototype._isBuffer=!0,i.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},i.prototype.write=function(e,t,r,n){switch(n){case"utf8":return function(e,t,r,n){return function(e,t,r,n){for(var s=0;s<n&&!(s+r>=t.length||s>=e.length);++s)t[s+r]=e[s];return s}(E(t,e.length-r),e,r,n)}(this,e,t,r);default:throw new TypeError("Unknown encoding: "+n)}};let l=4096;function f(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function h(e,t,r,n,s,o){if(!i.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>s||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function d(e,t,r){let n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"utf8":case"utf-8":return _(this,t,r);default:if(n)throw new TypeError("Unsupported encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function E(e,t=1/0){let r,n=t,s=e.length,i=null,o=[];for(let t=0;t<s;++t){if((r=e.charCodeAt(t))>55295&&r<57344){if(!i){if(r>56319){(n-=3)>-1&&o.push(239,191,189);continue}if(t+1===s){(n-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(n-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(n-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((n-=1)<0)break;o.push(r)}else if(r<2048){if((n-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((n-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((n-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function _(e,t,r){r=Math.min(e.length,r);let n=[],s=t;for(;s<r;){let t=e[s],i=null,o=t>239?4:t>223?3:t>191?2:1;if(s+o<=r){let r,n,a,u;switch(o){case 1:t<128&&(i=t);break;case 2:128==(192&(r=e[s+1]))&&(u=(31&t)<<6|63&r)>127&&(i=u);break;case 3:r=e[s+1],n=e[s+2],128==(192&r)&&128==(192&n)&&(u=(15&t)<<12|(63&r)<<6|63&n)>2047&&(u<55296||u>57343)&&(i=u);break;case 4:r=e[s+1],n=e[s+2],a=e[s+3],128==(192&r)&&128==(192&n)&&128==(192&a)&&(u=(15&t)<<18|(63&r)<<12|(63&n)<<6|63&a)>65535&&u<1114112&&(i=u)}}null===i?(i=65533,o=1):i>65535&&(i-=65536,n.push(i>>>10&1023|55296),i=56320|1023&i),n.push(i),s+=o}return function(e){let t=e.length;if(t<=l)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=l));return r}(n)}function p(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}i.prototype.slice=function(e,t){let r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);let n=this.subarray(e,t);return n.__proto__=i.prototype,n},i.prototype.readUInt8=function(e,t){return e>>>=0,t||f(e,1,this.length),this[e]},i.prototype.readUInt16BE=function(e,t){return e>>>=0,t||f(e,2,this.length),this[e]<<8|this[e+1]},i.prototype.readUInt32BE=function(e,t){return e>>>=0,t||f(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},i.prototype.readInt8=function(e,t){return e>>>=0,t||f(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},i.prototype.readInt16BE=function(e,t){e>>>=0,t||f(e,2,this.length);let r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},i.prototype.readInt32BE=function(e,t){return e>>>=0,t||f(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},i.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||h(this,e,t,1,255,0),this[t]=255&e,t+1},i.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||h(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},i.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||h(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},i.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||h(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},i.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||h(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},i.prototype.toString=function(){let e=this.length;return 0===e?"":d.apply(this,arguments)},i.byteLength=function(e,t){if(i.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||p(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);let r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;let s=!1;for(;;)switch(t){case"utf8":case"utf-8":return E(e).length;default:if(s)return n?-1:E(e).length;t=(""+t).toLowerCase(),s=!0}throw new Error("Unexpected path in function")},i.prototype.copy=function(e,t,r,n){if(!i.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);let s=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(let n=s-1;n>=0;--n)e[n+t]=this[n+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return s}}).call(this,r(9))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(r(24)),s=u(r(25)),i=u(r(1)),o=u(r(4)),a=u(r(5));function u(e){return e&&e.__esModule?e:{default:e}}class c{static just(...e){return new c(t=>{let r=!1,n=0;t.onSubscribe({cancel:()=>{r=!0},request:s=>{for(;!r&&s>0&&n<e.length;)t.onNext(e[n++]),s--;r||n!=e.length||t.onComplete()}})})}static error(e){return new c(t=>{t.onSubscribe({cancel:()=>{},request:()=>{t.onError(e)}})})}static never(){return new c(e=>{e.onSubscribe({cancel:a.default,request:a.default})})}constructor(e,t=Number.MAX_SAFE_INTEGER){this._max=t,this._source=e}subscribe(e){let t;t="function"==typeof e?this._wrapCallback(e):e;const r=new l(t,this._max);this._source(r)}lift(e){return new c(t=>this._source(e(t)))}map(e){return this.lift(t=>new n.default(t,e))}take(e){return this.lift(t=>new s.default(t,e))}_wrapCallback(e){const t=this._max;return{onNext:e,onSubscribe(e){e.request(t)}}}}t.default=c;class l{constructor(e,t){this._cancel=()=>{this._active&&(this._active=!1,this._subscription&&this._subscription.cancel())},this._request=e=>{(0,i.default)(Number.isInteger(e)&&e>=1&&e<=this._max,"Flowable: Expected request value to be an integer with a value greater than 0 and less than or equal to %s, got `%s`.",this._max,e),this._active&&(e===this._max?this._pending=this._max:(this._pending+=e,this._pending>=this._max&&(this._pending=this._max)),this._subscription&&this._subscription.request(e))},this._active=!1,this._max=t,this._pending=0,this._started=!1,this._subscriber=e||{},this._subscription=null}onComplete(){if(this._active){this._active=!1,this._started=!0;try{this._subscriber.onComplete&&this._subscriber.onComplete()}catch(e){this._subscriber.onError&&this._subscriber.onError(e)}}else(0,o.default)(!1,"Flowable: Invalid call to onComplete(): %s.",this._started?"onComplete/onError was already called":"onSubscribe has not been called")}onError(e){!this._started||this._active?(this._active=!1,this._started=!0,this._subscriber.onError&&this._subscriber.onError(e)):(0,o.default)(!1,"Flowable: Invalid call to onError(): %s.",this._active?"onComplete/onError was already called":"onSubscribe has not been called")}onNext(e){if(this._active)if(0!==this._pending){this._pending!==this._max&&this._pending--;try{this._subscriber.onNext&&this._subscriber.onNext(e)}catch(e){this._subscription&&this._subscription.cancel(),this.onError(e)}}else(0,o.default)(!1,"Flowable: Invalid call to onNext(), all request()ed values have been published.");else(0,o.default)(!1,"Flowable: Invalid call to onNext(): %s.",this._active?"onComplete/onError was already called":"onSubscribe has not been called")}onSubscribe(e){if(this._started)(0,o.default)(!1,"Flowable: Invalid call to onSubscribe(): already called.");else{this._active=!0,this._started=!0,this._subscription=e;try{this._subscriber.onSubscribe&&this._subscriber.onSubscribe({cancel:this._cancel,request:this._request})}catch(e){this.onError(e)}}}}},function(e,t,r){"use strict";e.exports=function(e){if(null!=e)return e;throw new Error("Got unexpected null or undefined")}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createServerMachine=function(e,t,r,n){return new f("SERVER",e,t,r,n)},t.createClientMachine=function(e,t,r,n){return new f("CLIENT",e,t,r,n)};var n=r(3),s=c(r(5)),i=c(r(1)),o=c(r(4)),a=r(2),u=r(7);function c(e){return e&&e.__esModule?e:{default:e}}class l{constructor(e){this._responder=e||{}}setResponder(e){this._responder=e||{}}fireAndForget(e){if(this._responder.fireAndForget)try{this._responder.fireAndForget(e)}catch(e){console.error("fireAndForget threw an exception",e)}}requestResponse(e){let t;if(this._responder.requestResponse)try{return this._responder.requestResponse(e)}catch(e){console.error("requestResponse threw an exception",e),t=e}return n.Single.error(t||new Error("not implemented"))}requestStream(e){let t;if(this._responder.requestStream)try{return this._responder.requestStream(e)}catch(e){console.error("requestStream threw an exception",e),t=e}return n.Flowable.error(t||new Error("not implemented"))}requestChannel(e){let t;if(this._responder.requestChannel)try{return this._responder.requestChannel(e)}catch(e){console.error("requestChannel threw an exception",e),t=e}return n.Flowable.error(t||new Error("not implemented"))}metadataPush(e){let t;if(this._responder.metadataPush)try{return this._responder.metadataPush(e)}catch(e){console.error("metadataPush threw an exception",e),t=e}return n.Single.error(t||new Error("not implemented"))}}class f{constructor(e,t,r,n,s){this._handleTransportClose=()=>{this._handleError(new Error("RSocket: The connection was closed."))},this._handleError=e=>{this._receivers.forEach(t=>{t.onError(e)}),this._receivers.clear(),this._subscriptions.forEach(e=>{e.cancel()}),this._subscriptions.clear()},this._handleFrame=e=>{const{streamId:t}=e;t===a.CONNECTION_STREAM_ID?this._handleConnectionFrame(e):this._handleStreamFrame(t,e)},this._connection=t,this._nextStreamId="CLIENT"===e?1:2,this._receivers=new Map,this._subscriptions=new Map,this._serializers=n||u.IdentitySerializers,this._requestHandler=new l(s),r({onComplete:this._handleTransportClose,onError:this._handleError,onNext:this._handleFrame,onSubscribe:e=>e.request(Number.MAX_SAFE_INTEGER)}),this._connection.connectionStatus().subscribe({onNext:e=>{"CLOSED"===e.kind?this._handleTransportClose():"ERROR"===e.kind&&this._handleError(e.error)},onSubscribe:e=>e.request(Number.MAX_SAFE_INTEGER)})}setRequestHandler(e){this._requestHandler.setResponder(e)}close(){this._connection.close()}connectionStatus(){return this._connection.connectionStatus()}fireAndForget(e){const t=this._getNextStreamId(),r=this._serializers.data.serialize(e.data),n=this._serializers.metadata.serialize(e.metadata),s={data:r,flags:void 0!==e.metadata?a.FLAGS.METADATA:0,metadata:n,streamId:t,type:a.FRAME_TYPES.REQUEST_FNF};this._connection.sendOne(s)}requestResponse(e){const t=this._getNextStreamId();return new n.Single(r=>{this._receivers.set(t,{onComplete:s.default,onError:e=>r.onError(e),onNext:e=>r.onComplete(e)});const n=this._serializers.data.serialize(e.data),i=this._serializers.metadata.serialize(e.metadata),o={data:n,flags:void 0!==e.metadata?a.FLAGS.METADATA:0,metadata:i,streamId:t,type:a.FRAME_TYPES.REQUEST_RESPONSE};this._connection.sendOne(o),r.onSubscribe(()=>{this._receivers.delete(t);const e={flags:0,streamId:t,type:a.FRAME_TYPES.CANCEL};this._connection.sendOne(e)})})}requestStream(e){const t=this._getNextStreamId();return new n.Flowable(r=>{this._receivers.set(t,r);let n=!1;r.onSubscribe({cancel:()=>{if(this._receivers.delete(t),!n)return;const e={flags:0,streamId:t,type:a.FRAME_TYPES.CANCEL};this._connection.sendOne(e)},request:r=>{if(r>a.MAX_REQUEST_N&&(r=a.MAX_REQUEST_N),n){const e={flags:0,requestN:r,streamId:t,type:a.FRAME_TYPES.REQUEST_N};this._connection.sendOne(e)}else{n=!0;const s=this._serializers.data.serialize(e.data),i=this._serializers.metadata.serialize(e.metadata),o={data:s,flags:void 0!==e.metadata?a.FLAGS.METADATA:0,metadata:i,requestN:r,streamId:t,type:a.FRAME_TYPES.REQUEST_STREAM};this._connection.sendOne(o)}}})},a.MAX_REQUEST_N)}requestChannel(e){const t=this._getNextStreamId();let r=!1;return new n.Flowable(n=>{try{this._receivers.set(t,n);let s=!1;n.onSubscribe({cancel:()=>{if(this._receivers.delete(t),!s)return;const e={flags:0,streamId:t,type:a.FRAME_TYPES.CANCEL};this._connection.sendOne(e)},request:n=>{if(n>a.MAX_REQUEST_N&&(n=a.MAX_REQUEST_N),s){const e={flags:0,requestN:n,streamId:t,type:a.FRAME_TYPES.REQUEST_N};this._connection.sendOne(e)}else r?(0,o.default)(!1,"RSocketClient: re-entrant call to request n before initial channel established."):(r=!0,e.subscribe({onComplete:()=>{this._sendStreamComplete(t)},onError:e=>{this._sendStreamError(t,e)},onNext:e=>{const r=this._serializers.data.serialize(e.data),i=this._serializers.metadata.serialize(e.metadata);if(s){const n={data:r,flags:a.FLAGS.NEXT|(void 0!==e.metadata?a.FLAGS.METADATA:0),metadata:i,streamId:t,type:a.FRAME_TYPES.PAYLOAD};this._connection.sendOne(n)}else{s=!0;const o={data:r,flags:void 0!==e.metadata?a.FLAGS.METADATA:0,metadata:i,requestN:n,streamId:t,type:a.FRAME_TYPES.REQUEST_CHANNEL};this._connection.sendOne(o)}},onSubscribe:e=>{this._subscriptions.set(t,e),e.request(1)}}))}})}catch(e){console.warn("Exception while subscribing to channel flowable:"+e)}},a.MAX_REQUEST_N)}metadataPush(e){throw new Error("metadataPush() is not implemented")}_getNextStreamId(){const e=this._nextStreamId;return(0,i.default)(e<=a.MAX_STREAM_ID,"RSocketClient: Cannot issue request, maximum stream id reached (%s).",a.MAX_STREAM_ID),this._nextStreamId+=2,e}_handleConnectionError(e){this._handleError(e),this._connection.close()}_handleConnectionFrame(e){switch(e.type){case a.FRAME_TYPES.ERROR:const t=(0,a.createErrorFromFrame)(e);this._handleConnectionError(t);break;case a.FRAME_TYPES.EXT:break;case a.FRAME_TYPES.KEEPALIVE:(0,a.isRespond)(e.flags)&&this._connection.sendOne(Object.assign({},e,{flags:e.flags^a.FLAGS.RESPOND,lastReceivedPosition:0}));break;case a.FRAME_TYPES.LEASE:break;case a.FRAME_TYPES.METADATA_PUSH:case a.FRAME_TYPES.REQUEST_CHANNEL:case a.FRAME_TYPES.REQUEST_FNF:case a.FRAME_TYPES.REQUEST_RESPONSE:case a.FRAME_TYPES.REQUEST_STREAM:case a.FRAME_TYPES.RESERVED:break;case a.FRAME_TYPES.RESUME:case a.FRAME_TYPES.RESUME_OK:break;default:0}}_handleStreamFrame(e,t){switch(t.type){case a.FRAME_TYPES.CANCEL:this._handleCancel(e,t);break;case a.FRAME_TYPES.REQUEST_N:this._handleRequestN(e,t);break;case a.FRAME_TYPES.REQUEST_FNF:this._handleFireAndForget(e,t);break;case a.FRAME_TYPES.REQUEST_RESPONSE:this._handleRequestResponse(e,t);break;case a.FRAME_TYPES.REQUEST_STREAM:this._handleRequestStream(e,t);break;case a.FRAME_TYPES.REQUEST_CHANNEL:this._handleRequestChannel(e,t);break;case a.FRAME_TYPES.ERROR:const r=(0,a.createErrorFromFrame)(t);this._handleStreamError(e,r);break;case a.FRAME_TYPES.PAYLOAD:const n=this._receivers.get(e);if(null!=n){if((0,a.isNext)(t.flags)){const e={data:this._serializers.data.deserialize(t.data),metadata:this._serializers.metadata.deserialize(t.metadata)};n.onNext(e)}(0,a.isComplete)(t.flags)&&(this._receivers.delete(e),n.onComplete())}break;default:0}}_handleCancel(e,t){const r=this._subscriptions.get(e);r&&(r.cancel(),this._subscriptions.delete(e))}_handleRequestN(e,t){const r=this._subscriptions.get(e);r&&r.request(t.requestN)}_handleFireAndForget(e,t){const r=this._deserializePayload(t);this._requestHandler.fireAndForget(r)}_handleRequestResponse(e,t){const r=this._deserializePayload(t);this._requestHandler.requestResponse(r).subscribe({onComplete:t=>{this._sendStreamPayload(e,t,!0)},onError:t=>this._sendStreamError(e,t),onSubscribe:t=>{const r={cancel:t,request:s.default};this._subscriptions.set(e,r)}})}_handleRequestStream(e,t){const r=this._deserializePayload(t);this._requestHandler.requestStream(r).subscribe({onComplete:()=>this._sendStreamComplete(e),onError:t=>this._sendStreamError(e,t),onNext:t=>this._sendStreamPayload(e,t),onSubscribe:r=>{this._subscriptions.set(e,r),r.request(t.requestN)}})}_handleRequestChannel(e,t){if(this._subscriptions.get(e))return;const r=new n.Flowable(r=>{let n=!0;r.onSubscribe({cancel:()=>{this._receivers.delete(e);const t={flags:0,streamId:e,type:a.FRAME_TYPES.CANCEL};this._connection.sendOne(t)},request:s=>{if(s>a.MAX_REQUEST_N&&(s=a.MAX_REQUEST_N),n&&s--,s>0){const t={flags:0,requestN:s,streamId:e,type:a.FRAME_TYPES.REQUEST_N};this._connection.sendOne(t)}n&&s>=0&&(n=!1,r.onNext(t))}})},a.MAX_REQUEST_N),s=new n.FlowableProcessor(r,e=>this._deserializePayload(e));this._receivers.set(e,s),this._requestHandler.requestChannel(s).subscribe({onComplete:()=>this._sendStreamComplete(e),onError:t=>this._sendStreamError(e,t),onNext:t=>this._sendStreamPayload(e,t),onSubscribe:r=>{this._subscriptions.set(e,r),r.request(t.requestN)}})}_sendStreamComplete(e){this._subscriptions.delete(e),this._connection.sendOne({data:null,flags:a.FLAGS.COMPLETE,metadata:null,streamId:e,type:a.FRAME_TYPES.PAYLOAD})}_sendStreamError(e,t){this._subscriptions.delete(e),this._connection.sendOne({code:a.ERROR_CODES.APPLICATION_ERROR,flags:0,message:t.message,streamId:e,type:a.FRAME_TYPES.ERROR})}_sendStreamPayload(e,t,r=!1){let n=a.FLAGS.NEXT;r&&(n|=a.FLAGS.COMPLETE,this._subscriptions.delete(e));const s=this._serializers.data.serialize(t.data),i=this._serializers.metadata.serialize(t.metadata);this._connection.sendOne({data:s,flags:n,metadata:i,streamId:e,type:a.FRAME_TYPES.PAYLOAD})}_deserializePayload(e){return function(e,t){return{data:e.data.deserialize(t.data),metadata:e.metadata.deserialize(t.metadata)}}(this._serializers,e)}_handleStreamError(e,t){const r=this._receivers.get(e);null!=r&&(this._receivers.delete(e),r.onError(t))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(32);Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})}));var s=r(33);Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,s=r(34),i=(n=s)&&n.__esModule?n:{default:n};t.default=i.default},function(e,t,r){"use strict";var n=Object.prototype.hasOwnProperty;e.exports=function(e,t,r){for(var s in e)n.call(e,s)&&t.call(r,e[s],s,e)}},function(e,t,r){"use strict";e.exports=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var s=0;return e.replace(/%s/g,(function(e){return r[s++]}))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deserializeFrameWithLength=function(e,t){const r=(0,u.readUInt24BE)(e,0);return f(e.slice(l,l+r),t)},t.deserializeFrames=function(e,t){const r=[];let n=0;for(;n+l<e.length;){const s=(0,u.readUInt24BE)(e,n),i=n+l,o=i+s;if(o>e.length)break;const a=f(e.slice(i,o),t);r.push(a),n=o}return[r,e.slice(n,e.length)]},t.serializeFrameWithLength=function(e,t){const r=h(e,t),n=(0,u.createBuffer)(r.length+l);return(0,u.writeUInt24BE)(n,r.length,0),r.copy(n,l,0,r.length),n},t.deserializeFrame=f,t.serializeFrame=h;var n,s=r(1),i=(n=s)&&n.__esModule?n:{default:n},o=r(2),a=r(8),u=r(6);const c=6,l=3;function f(e,t){t=t||a.Utf8Encoders;let r=0;const n=e.readInt32BE(r);r+=4,(0,i.default)(n>=0,"RSocketBinaryFraming: Invalid frame, expected a positive stream id, got `%s.",n);const s=e.readUInt16BE(r);r+=2;const l=s>>>o.FRAME_TYPE_OFFFSET,f=s&o.FLAGS_MASK;switch(l){case o.FRAME_TYPES.SETUP:return function(e,t,r,n){(0,i.default)(0===t,"RSocketBinaryFraming: Invalid SETUP frame, expected stream id to be 0.");let s=c;const a=e.readUInt16BE(s);s+=2;const u=e.readUInt16BE(s);s+=2;const l=e.readInt32BE(s);s+=4,(0,i.default)(l>=0&&l<=o.MAX_KEEPALIVE,"RSocketBinaryFraming: Invalid SETUP frame, expected keepAlive to be >= 0 and <= %s. Got `%s`.",o.MAX_KEEPALIVE,l);const f=e.readInt32BE(s);s+=4,(0,i.default)(f>=0&&f<=o.MAX_LIFETIME,"RSocketBinaryFraming: Invalid SETUP frame, expected lifetime to be >= 0 and <= %s. Got `%s`.",o.MAX_LIFETIME,f);let h=null;if(r&o.FLAGS.RESUME_ENABLE){const t=e.readInt16BE(s);s+=2,(0,i.default)(t>=0&&t<=o.MAX_RESUME_LENGTH,"RSocketBinaryFraming: Invalid SETUP frame, expected resumeToken length to be >= 0 and <= %s. Got `%s`.",o.MAX_RESUME_LENGTH,t),h=n.resumeToken.decode(e,s,s+t),s+=t}const d=e.readUInt8(s);s+=1;const E=n.metadataMimeType.decode(e,s,s+d);s+=d;const _=e.readUInt8(s);s+=1;const p=n.dataMimeType.decode(e,s,s+_);s+=_;const m={data:null,dataMimeType:p,flags:r,keepAlive:l,lifetime:f,majorVersion:a,metadata:null,metadataMimeType:E,minorVersion:u,resumeToken:h,streamId:t,type:o.FRAME_TYPES.SETUP};return M(e,m,n,s),m}(e,n,f,t);case o.FRAME_TYPES.PAYLOAD:return function(e,t,r,n){(0,i.default)(t>0,"RSocketBinaryFraming: Invalid PAYLOAD frame, expected stream id to be > 0.");const s={data:null,flags:r,metadata:null,streamId:t,type:o.FRAME_TYPES.PAYLOAD};return M(e,s,n,c),s}(e,n,f,t);case o.FRAME_TYPES.ERROR:return function(e,t,r,n){let s=c;const a=e.readInt32BE(s);s+=4,(0,i.default)(a>=0&&a<=o.MAX_CODE,"RSocketBinaryFraming: Invalid ERROR frame, expected code to be >= 0 and <= %s. Got `%s`.",o.MAX_CODE,a);const u=e.length-s;let l="";u>0&&(l=n.message.decode(e,s,s+u),s+=u);return{code:a,flags:r,message:l,streamId:t,type:o.FRAME_TYPES.ERROR}}(e,n,f,t);case o.FRAME_TYPES.KEEPALIVE:return function(e,t,r,n){(0,i.default)(0===t,"RSocketBinaryFraming: Invalid KEEPALIVE frame, expected stream id to be 0.");let s=c;const a=(0,u.readUInt64BE)(e,s);let l=null;(s+=8)<e.length&&(l=n.data.decode(e,s,e.length));return{data:l,flags:r,lastReceivedPosition:a,streamId:t,type:o.FRAME_TYPES.KEEPALIVE}}(e,n,f,t);case o.FRAME_TYPES.REQUEST_FNF:return function(e,t,r,n){(0,i.default)(t>0,"RSocketBinaryFraming: Invalid REQUEST_FNF frame, expected stream id to be > 0.");const s={data:null,flags:r,metadata:null,streamId:t,type:o.FRAME_TYPES.REQUEST_FNF};return M(e,s,n,c),s}(e,n,f,t);case o.FRAME_TYPES.REQUEST_RESPONSE:return function(e,t,r,n){(0,i.default)(t>0,"RSocketBinaryFraming: Invalid REQUEST_RESPONSE frame, expected stream id to be > 0.");const s={data:null,flags:r,metadata:null,streamId:t,type:o.FRAME_TYPES.REQUEST_RESPONSE};return M(e,s,n,c),s}(e,n,f,t);case o.FRAME_TYPES.REQUEST_STREAM:return function(e,t,r,n){(0,i.default)(t>0,"RSocketBinaryFraming: Invalid REQUEST_STREAM frame, expected stream id to be > 0.");let s=c;const a=e.readInt32BE(s);s+=4,(0,i.default)(a>0,"RSocketBinaryFraming: Invalid REQUEST_STREAM frame, expected requestN to be > 0, got `%s`.",a);const u={data:null,flags:r,metadata:null,requestN:a,streamId:t,type:o.FRAME_TYPES.REQUEST_STREAM};return M(e,u,n,s),u}(e,n,f,t);case o.FRAME_TYPES.REQUEST_CHANNEL:return function(e,t,r,n){(0,i.default)(t>0,"RSocketBinaryFraming: Invalid REQUEST_CHANNEL frame, expected stream id to be > 0.");let s=c;const a=e.readInt32BE(s);s+=4,(0,i.default)(a>0,"RSocketBinaryFraming: Invalid REQUEST_STREAM frame, expected requestN to be > 0, got `%s`.",a);const u={data:null,flags:r,metadata:null,requestN:a,streamId:t,type:o.FRAME_TYPES.REQUEST_CHANNEL};return M(e,u,n,s),u}(e,n,f,t);case o.FRAME_TYPES.REQUEST_N:return function(e,t,r,n){(0,i.default)(t>0,"RSocketBinaryFraming: Invalid REQUEST_N frame, expected stream id to be > 0.");const s=e.readInt32BE(c);return(0,i.default)(s>0,"RSocketBinaryFraming: Invalid REQUEST_STREAM frame, expected requestN to be > 0, got `%s`.",s),{flags:r,requestN:s,streamId:t,type:o.FRAME_TYPES.REQUEST_N}}(e,n,f);case o.FRAME_TYPES.RESUME:return function(e,t,r,n){(0,i.default)(0===t,"RSocketBinaryFraming: Invalid RESUME frame, expected stream id to be 0.");let s=c;const a=e.readUInt16BE(s);s+=2;const l=e.readUInt16BE(s);s+=2;const f=e.readInt16BE(s);s+=2,(0,i.default)(f>=0&&f<=o.MAX_RESUME_LENGTH,"RSocketBinaryFraming: Invalid SETUP frame, expected resumeToken length to be >= 0 and <= %s. Got `%s`.",o.MAX_RESUME_LENGTH,f);const h=n.resumeToken.decode(e,s,s+f);s+=f;const d=(0,u.readUInt64BE)(e,s);s+=8;const E=(0,u.readUInt64BE)(e,s);return s+=8,{clientPosition:d,flags:r,majorVersion:a,minorVersion:l,resumeToken:h,serverPosition:E,streamId:t,type:o.FRAME_TYPES.RESUME}}(e,n,f,t);case o.FRAME_TYPES.RESUME_OK:return function(e,t,r,n){return(0,i.default)(0===t,"RSocketBinaryFraming: Invalid RESUME frame, expected stream id to be 0."),{clientPosition:(0,u.readUInt64BE)(e,c),flags:r,streamId:t,type:o.FRAME_TYPES.RESUME_OK}}(e,n,f);case o.FRAME_TYPES.CANCEL:return function(e,t,r,n){return(0,i.default)(t>0,"RSocketBinaryFraming: Invalid CANCEL frame, expected stream id to be > 0."),{flags:r,streamId:t,type:o.FRAME_TYPES.CANCEL}}(0,n,f);case o.FRAME_TYPES.LEASE:return function(e,t,r,n){(0,i.default)(0===t,"RSocketBinaryFraming: Invalid LEASE frame, expected stream id to be 0.");let s=c;const a=e.readUInt32BE(s);s+=4;const u=e.readUInt32BE(s);let l=null;(s+=4)<e.length&&(l=n.metadata.decode(e,s,e.length));return{flags:r,metadata:l,requestCount:u,streamId:t,ttl:a,type:o.FRAME_TYPES.LEASE}}(e,n,f,t);default:(0,i.default)(!1,"RSocketBinaryFraming: Unsupported frame type `%s`.",(0,o.getFrameTypeName)(l))}}function h(e,t){switch(t=t||a.Utf8Encoders,e.type){case o.FRAME_TYPES.SETUP:return function(e,t){const r=null!=e.resumeToken?t.resumeToken.byteLength(e.resumeToken):0,n=null!=e.metadataMimeType?t.metadataMimeType.byteLength(e.metadataMimeType):0,s=null!=e.dataMimeType?t.dataMimeType.byteLength(e.dataMimeType):0,i=T(e,t),a=(0,u.createBuffer)(c+d+(r?E+r:0)+n+s+i);let l=y(e,a);l=a.writeUInt16BE(e.majorVersion,l),l=a.writeUInt16BE(e.minorVersion,l),l=a.writeUInt32BE(e.keepAlive,l),l=a.writeUInt32BE(e.lifetime,l),e.flags&o.FLAGS.RESUME_ENABLE&&(l=a.writeUInt16BE(r,l),null!=e.resumeToken&&(l=t.resumeToken.encode(e.resumeToken,a,l,l+r)));l=a.writeUInt8(n,l),null!=e.metadataMimeType&&(l=t.metadataMimeType.encode(e.metadataMimeType,a,l,l+n));l=a.writeUInt8(s,l),null!=e.dataMimeType&&(l=t.dataMimeType.encode(e.dataMimeType,a,l,l+s));return A(e,a,t,l),a}(e,t);case o.FRAME_TYPES.PAYLOAD:return function(e,t){const r=T(e,t),n=(0,u.createBuffer)(c+r),s=y(e,n);return A(e,n,t,s),n}(e,t);case o.FRAME_TYPES.ERROR:return function(e,t){const r=null!=e.message?t.message.byteLength(e.message):0,n=(0,u.createBuffer)(c+_+r);let s=y(e,n);s=n.writeUInt32BE(e.code,s),null!=e.message&&t.message.encode(e.message,n,s,s+r);return n}(e,t);case o.FRAME_TYPES.KEEPALIVE:return function(e,t){const r=null!=e.data?t.data.byteLength(e.data):0,n=(0,u.createBuffer)(c+p+r);let s=y(e,n);s=(0,u.writeUInt64BE)(n,e.lastReceivedPosition,s),null!=e.data&&t.data.encode(e.data,n,s,s+r);return n}(e,t);case o.FRAME_TYPES.REQUEST_FNF:case o.FRAME_TYPES.REQUEST_RESPONSE:return function(e,t){const r=T(e,t),n=(0,u.createBuffer)(c+r),s=y(e,n);return A(e,n,t,s),n}(e,t);case o.FRAME_TYPES.REQUEST_STREAM:case o.FRAME_TYPES.REQUEST_CHANNEL:return function(e,t){const r=T(e,t),n=(0,u.createBuffer)(c+b+r);let s=y(e,n);return s=n.writeUInt32BE(e.requestN,s),A(e,n,t,s),n}(e,t);case o.FRAME_TYPES.REQUEST_N:return function(e,t){const r=(0,u.createBuffer)(c+S),n=y(e,r);return r.writeUInt32BE(e.requestN,n),r}(e);case o.FRAME_TYPES.RESUME:return function(e,t){const r=t.resumeToken.byteLength(e.resumeToken),n=(0,u.createBuffer)(c+g+r);let s=y(e,n);return s=n.writeUInt16BE(e.majorVersion,s),s=n.writeUInt16BE(e.minorVersion,s),s=n.writeUInt16BE(r,s),s=t.resumeToken.encode(e.resumeToken,n,s,s+r),s=(0,u.writeUInt64BE)(n,e.clientPosition,s),(0,u.writeUInt64BE)(n,e.serverPosition,s),n}(e,t);case o.FRAME_TYPES.RESUME_OK:return function(e,t){const r=(0,u.createBuffer)(c+R),n=y(e,r);return(0,u.writeUInt64BE)(r,e.clientPosition,n),r}(e);case o.FRAME_TYPES.CANCEL:return function(e,t){const r=(0,u.createBuffer)(c);return y(e,r),r}(e);case o.FRAME_TYPES.LEASE:return function(e,t){const r=null!=e.metadata?t.metadata.byteLength(e.metadata):0,n=(0,u.createBuffer)(c+m+r);let s=y(e,n);s=n.writeUInt32BE(e.ttl,s),s=n.writeUInt32BE(e.requestCount,s),null!=e.metadata&&t.metadata.encode(e.metadata,n,s,s+r);return n}(e,t);default:(0,i.default)(!1,"RSocketBinaryFraming: Unsupported frame type `%s`.",(0,o.getFrameTypeName)(e.type))}}const d=14,E=2;const _=4;const p=8;const m=8;const b=4;const S=4;const g=22;const R=8;function y(e,t){const r=t.writeInt32BE(e.streamId,0);return t.writeUInt16BE(e.type<<o.FRAME_TYPE_OFFFSET|e.flags&o.FLAGS_MASK,r)}function T(e,t){let r=0;return null!=e.data&&(r+=t.data.byteLength(e.data)),(0,o.isMetadata)(e.flags)&&(r+=l,null!=e.metadata&&(r+=t.metadata.byteLength(e.metadata))),r}function A(e,t,r,n){if((0,o.isMetadata)(e.flags))if(null!=e.metadata){const s=r.metadata.byteLength(e.metadata);n=(0,u.writeUInt24BE)(t,s,n),n=r.metadata.encode(e.metadata,t,n,n+s)}else n=(0,u.writeUInt24BE)(t,0,n);null!=e.data&&r.data.encode(e.data,t,n,t.length)}function M(e,t,r,n){if((0,o.isMetadata)(t.flags)){const s=(0,u.readUInt24BE)(e,n);n+=l,s>0&&(t.metadata=r.metadata.decode(e,n,n+s),n+=s)}n<e.length&&(t.data=r.data.decode(e,n,e.length))}},function(e,t,r){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var n=r(20),s=r(21),i=r(22);function o(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=u.prototype:(null===e&&(e=new u(t)),e.length=t),e}function u(e,t,r){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return f(this,e)}return c(this,e,t,r)}function c(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);u.TYPED_ARRAY_SUPPORT?(e=t).__proto__=u.prototype:e=h(e,t);return e}(e,t,r,n):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!u.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|E(t,r),s=(e=a(e,n)).write(t,r);s!==n&&(e=e.slice(0,s));return e}(e,t,r):function(e,t){if(u.isBuffer(t)){var r=0|d(t.length);return 0===(e=a(e,r)).length?e:(t.copy(e,0,0,r),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length)!=n?a(e,0):h(e,t);if("Buffer"===t.type&&i(t.data))return h(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function f(e,t){if(l(t),e=a(e,t<0?0:0|d(t)),!u.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function h(e,t){var r=t.length<0?0:0|d(t.length);e=a(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function d(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function E(e,t){if(u.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return z(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return j(e).length;default:if(n)return z(e).length;t=(""+t).toLowerCase(),n=!0}}function _(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return P(this,t,r);case"utf8":case"utf-8":return v(this,t,r);case"ascii":return N(this,t,r);case"latin1":case"binary":return O(this,t,r);case"base64":return M(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function p(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function m(e,t,r,n,s){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=s?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(s)return-1;r=e.length-1}else if(r<0){if(!s)return-1;r=0}if("string"==typeof t&&(t=u.from(t,n)),u.isBuffer(t))return 0===t.length?-1:b(e,t,r,n,s);if("number"==typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):b(e,[t],r,n,s);throw new TypeError("val must be string, number or Buffer")}function b(e,t,r,n,s){var i,o=1,a=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,a/=2,u/=2,r/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(s){var l=-1;for(i=r;i<a;i++)if(c(e,i)===c(t,-1===l?0:i-l)){if(-1===l&&(l=i),i-l+1===u)return l*o}else-1!==l&&(i-=i-l),l=-1}else for(r+u>a&&(r=a-u),i=r;i>=0;i--){for(var f=!0,h=0;h<u;h++)if(c(e,i+h)!==c(t,h)){f=!1;break}if(f)return i}return-1}function S(e,t,r,n){r=Number(r)||0;var s=e.length-r;n?(n=Number(n))>s&&(n=s):n=s;var i=t.length;if(i%2!=0)throw new TypeError("Invalid hex string");n>i/2&&(n=i/2);for(var o=0;o<n;++o){var a=parseInt(t.substr(2*o,2),16);if(isNaN(a))return o;e[r+o]=a}return o}function g(e,t,r,n){return q(z(t,e.length-r),e,r,n)}function R(e,t,r,n){return q(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function y(e,t,r,n){return R(e,t,r,n)}function T(e,t,r,n){return q(j(t),e,r,n)}function A(e,t,r,n){return q(function(e,t){for(var r,n,s,i=[],o=0;o<e.length&&!((t-=2)<0);++o)r=e.charCodeAt(o),n=r>>8,s=r%256,i.push(s),i.push(n);return i}(t,e.length-r),e,r,n)}function M(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function v(e,t,r){r=Math.min(e.length,r);for(var n=[],s=t;s<r;){var i,o,a,u,c=e[s],l=null,f=c>239?4:c>223?3:c>191?2:1;if(s+f<=r)switch(f){case 1:c<128&&(l=c);break;case 2:128==(192&(i=e[s+1]))&&(u=(31&c)<<6|63&i)>127&&(l=u);break;case 3:i=e[s+1],o=e[s+2],128==(192&i)&&128==(192&o)&&(u=(15&c)<<12|(63&i)<<6|63&o)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:i=e[s+1],o=e[s+2],a=e[s+3],128==(192&i)&&128==(192&o)&&128==(192&a)&&(u=(15&c)<<18|(63&i)<<12|(63&o)<<6|63&a)>65535&&u<1114112&&(l=u)}null===l?(l=65533,f=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),s+=f}return function(e){var t=e.length;if(t<=w)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=w));return r}(n)}t.Buffer=u,t.SlowBuffer=function(e){+e!=e&&(e=0);return u.alloc(+e)},t.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=o(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,r){return c(null,e,t,r)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(e,t,r){return function(e,t,r,n){return l(t),t<=0?a(e,t):void 0!==r?"string"==typeof n?a(e,t).fill(r,n):a(e,t).fill(r):a(e,t)}(null,e,t,r)},u.allocUnsafe=function(e){return f(null,e)},u.allocUnsafeSlow=function(e){return f(null,e)},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,s=0,i=Math.min(r,n);s<i;++s)if(e[s]!==t[s]){r=e[s],n=t[s];break}return r<n?-1:n<r?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!i(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=u.allocUnsafe(t),s=0;for(r=0;r<e.length;++r){var o=e[r];if(!u.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,s),s+=o.length}return n},u.byteLength=E,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)p(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)p(this,t,t+3),p(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)p(this,t,t+7),p(this,t+1,t+6),p(this,t+2,t+5),p(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?v(this,0,e):_.apply(this,arguments)},u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},u.prototype.compare=function(e,t,r,n,s){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===s&&(s=this.length),t<0||r>e.length||n<0||s>this.length)throw new RangeError("out of range index");if(n>=s&&t>=r)return 0;if(n>=s)return-1;if(t>=r)return 1;if(this===e)return 0;for(var i=(s>>>=0)-(n>>>=0),o=(r>>>=0)-(t>>>=0),a=Math.min(i,o),c=this.slice(n,s),l=e.slice(t,r),f=0;f<a;++f)if(c[f]!==l[f]){i=c[f],o=l[f];break}return i<o?-1:o<i?1:0},u.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},u.prototype.indexOf=function(e,t,r){return m(this,e,t,r,!0)},u.prototype.lastIndexOf=function(e,t,r){return m(this,e,t,r,!1)},u.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var s=this.length-t;if((void 0===r||r>s)&&(r=s),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var i=!1;;)switch(n){case"hex":return S(this,e,t,r);case"utf8":case"utf-8":return g(this,e,t,r);case"ascii":return R(this,e,t,r);case"latin1":case"binary":return y(this,e,t,r);case"base64":return T(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,e,t,r);default:if(i)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),i=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var w=4096;function N(e,t,r){var n="";r=Math.min(e.length,r);for(var s=t;s<r;++s)n+=String.fromCharCode(127&e[s]);return n}function O(e,t,r){var n="";r=Math.min(e.length,r);for(var s=t;s<r;++s)n+=String.fromCharCode(e[s]);return n}function P(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var s="",i=t;i<r;++i)s+=D(e[i]);return s}function I(e,t,r){for(var n=e.slice(t,r),s="",i=0;i<n.length;i+=2)s+=String.fromCharCode(n[i]+256*n[i+1]);return s}function F(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function C(e,t,r,n,s,i){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>s||t<i)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function U(e,t,r,n){t<0&&(t=65535+t+1);for(var s=0,i=Math.min(e.length-r,2);s<i;++s)e[r+s]=(t&255<<8*(n?s:1-s))>>>8*(n?s:1-s)}function B(e,t,r,n){t<0&&(t=4294967295+t+1);for(var s=0,i=Math.min(e.length-r,4);s<i;++s)e[r+s]=t>>>8*(n?s:3-s)&255}function L(e,t,r,n,s,i){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function k(e,t,r,n,i){return i||L(e,0,r,4),s.write(e,t,r,n,23,4),r+4}function x(e,t,r,n,i){return i||L(e,0,r,8),s.write(e,t,r,n,52,8),r+8}u.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),u.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=u.prototype;else{var s=t-e;r=new u(s,void 0);for(var i=0;i<s;++i)r[i]=this[i+e]}return r},u.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||F(e,t,this.length);for(var n=this[e],s=1,i=0;++i<t&&(s*=256);)n+=this[e+i]*s;return n},u.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||F(e,t,this.length);for(var n=this[e+--t],s=1;t>0&&(s*=256);)n+=this[e+--t]*s;return n},u.prototype.readUInt8=function(e,t){return t||F(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||F(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||F(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||F(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||F(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||F(e,t,this.length);for(var n=this[e],s=1,i=0;++i<t&&(s*=256);)n+=this[e+i]*s;return n>=(s*=128)&&(n-=Math.pow(2,8*t)),n},u.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||F(e,t,this.length);for(var n=t,s=1,i=this[e+--n];n>0&&(s*=256);)i+=this[e+--n]*s;return i>=(s*=128)&&(i-=Math.pow(2,8*t)),i},u.prototype.readInt8=function(e,t){return t||F(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){t||F(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt16BE=function(e,t){t||F(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt32LE=function(e,t){return t||F(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||F(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||F(e,4,this.length),s.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||F(e,4,this.length),s.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||F(e,8,this.length),s.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||F(e,8,this.length),s.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||C(this,e,t,r,Math.pow(2,8*r)-1,0);var s=1,i=0;for(this[t]=255&e;++i<r&&(s*=256);)this[t+i]=e/s&255;return t+r},u.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||C(this,e,t,r,Math.pow(2,8*r)-1,0);var s=r-1,i=1;for(this[t+s]=255&e;--s>=0&&(i*=256);)this[t+s]=e/i&255;return t+r},u.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):U(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):U(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):B(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):B(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var s=Math.pow(2,8*r-1);C(this,e,t,r,s-1,-s)}var i=0,o=1,a=0;for(this[t]=255&e;++i<r&&(o*=256);)e<0&&0===a&&0!==this[t+i-1]&&(a=1),this[t+i]=(e/o>>0)-a&255;return t+r},u.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var s=Math.pow(2,8*r-1);C(this,e,t,r,s-1,-s)}var i=r-1,o=1,a=0;for(this[t+i]=255&e;--i>=0&&(o*=256);)e<0&&0===a&&0!==this[t+i+1]&&(a=1),this[t+i]=(e/o>>0)-a&255;return t+r},u.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):U(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):U(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):B(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||C(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):B(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,r){return k(this,e,t,!0,r)},u.prototype.writeFloatBE=function(e,t,r){return k(this,e,t,!1,r)},u.prototype.writeDoubleLE=function(e,t,r){return x(this,e,t,!0,r)},u.prototype.writeDoubleBE=function(e,t,r){return x(this,e,t,!1,r)},u.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var s,i=n-r;if(this===e&&r<t&&t<n)for(s=i-1;s>=0;--s)e[s+t]=this[s+r];else if(i<1e3||!u.TYPED_ARRAY_SUPPORT)for(s=0;s<i;++s)e[s+t]=this[s+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+i),t);return i},u.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var s=e.charCodeAt(0);s<256&&(e=s)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!u.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var i;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var o=u.isBuffer(e)?e:z(new u(e,n).toString()),a=o.length;for(i=0;i<r-t;++i)this[i+t]=o[i%a]}return this};var Y=/[^+\/0-9A-Za-z-_]/g;function D(e){return e<16?"0"+e.toString(16):e.toString(16)}function z(e,t){var r;t=t||1/0;for(var n=e.length,s=null,i=[],o=0;o<n;++o){if((r=e.charCodeAt(o))>55295&&r<57344){if(!s){if(r>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&i.push(239,191,189);continue}s=r;continue}if(r<56320){(t-=3)>-1&&i.push(239,191,189),s=r;continue}r=65536+(s-55296<<10|r-56320)}else s&&(t-=3)>-1&&i.push(239,191,189);if(s=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function j(e){return n.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(Y,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function q(e,t,r,n){for(var s=0;s<n&&!(s+r>=t.length||s>=e.length);++s)t[s+r]=e[s];return s}}).call(this,r(9))},function(e,t,r){"use strict";t.byteLength=function(e){var t=c(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){var t,r,n=c(e),o=n[0],a=n[1],u=new i(function(e,t,r){return 3*(t+r)/4-r}(0,o,a)),l=0,f=a>0?o-4:o;for(r=0;r<f;r+=4)t=s[e.charCodeAt(r)]<<18|s[e.charCodeAt(r+1)]<<12|s[e.charCodeAt(r+2)]<<6|s[e.charCodeAt(r+3)],u[l++]=t>>16&255,u[l++]=t>>8&255,u[l++]=255&t;2===a&&(t=s[e.charCodeAt(r)]<<2|s[e.charCodeAt(r+1)]>>4,u[l++]=255&t);1===a&&(t=s[e.charCodeAt(r)]<<10|s[e.charCodeAt(r+1)]<<4|s[e.charCodeAt(r+2)]>>2,u[l++]=t>>8&255,u[l++]=255&t);return u},t.fromByteArray=function(e){for(var t,r=e.length,s=r%3,i=[],o=0,a=r-s;o<a;o+=16383)i.push(l(e,o,o+16383>a?a:o+16383));1===s?(t=e[r-1],i.push(n[t>>2]+n[t<<4&63]+"==")):2===s&&(t=(e[r-2]<<8)+e[r-1],i.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return i.join("")};for(var n=[],s=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,u=o.length;a<u;++a)n[a]=o[a],s[o.charCodeAt(a)]=a;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function l(e,t,r){for(var s,i,o=[],a=t;a<r;a+=3)s=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(n[(i=s)>>18&63]+n[i>>12&63]+n[i>>6&63]+n[63&i]);return o.join("")}s["-".charCodeAt(0)]=62,s["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,r,n,s){var i,o,a=8*s-n-1,u=(1<<a)-1,c=u>>1,l=-7,f=r?s-1:0,h=r?-1:1,d=e[t+f];for(f+=h,i=d&(1<<-l)-1,d>>=-l,l+=a;l>0;i=256*i+e[t+f],f+=h,l-=8);for(o=i&(1<<-l)-1,i>>=-l,l+=n;l>0;o=256*o+e[t+f],f+=h,l-=8);if(0===i)i=1-c;else{if(i===u)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,n),i-=c}return(d?-1:1)*o*Math.pow(2,i-n)},t.write=function(e,t,r,n,s,i){var o,a,u,c=8*i-s-1,l=(1<<c)-1,f=l>>1,h=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:i-1,E=n?1:-1,_=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-o))<1&&(o--,u*=2),(t+=o+f>=1?h/u:h*Math.pow(2,1-f))*u>=2&&(o++,u/=2),o+f>=l?(a=0,o=l):o+f>=1?(a=(t*u-1)*Math.pow(2,s),o+=f):(a=t*Math.pow(2,f-1)*Math.pow(2,s),o=0));s>=8;e[r+d]=255&a,d+=E,a/=256,s-=8);for(o=o<<s|a,c+=s;c>0;e[r+d]=255&o,d+=E,o/=256,c-=8);e[r+d-E]|=128*_}},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,s=r(3),i=r(1),o=(n=i)&&n.__esModule?n:{default:n},a=r(2),u=r(29),c=r(13);t.default=class{constructor(e){this._cancel=null,this._config=e,this._connection=null,this._socket=null}close(){this._config.transport.close()}connect(){return(0,o.default)(!this._connection,"RSocketClient: Unexpected call to connect(), already connected."),this._connection=new s.Single(e=>{const t=this._config.transport;let r;t.connectionStatus().subscribe({onNext:n=>{"CONNECTED"===n.kind?(r&&r.cancel(),e.onComplete(new l(this._config,t))):"ERROR"===n.kind?(r&&r.cancel(),e.onError(n.error)):"CLOSED"===n.kind&&(r&&r.cancel(),e.onError(new Error("RSocketClient: Connection closed.")))},onSubscribe:t=>{e.onSubscribe(()=>t.cancel()),(r=t).request(Number.MAX_SAFE_INTEGER)}}),t.connect()}),this._connection}};class l{constructor(e,t){this._machine=(0,c.createClientMachine)(t,e=>t.receive().subscribe(e),e.serializers,e.responder),t.sendOne(this._buildSetupFrame(e));const{keepAlive:r}=e.setup,n=(0,s.every)(r).map(()=>({data:null,flags:a.FLAGS.RESPOND,lastReceivedPosition:0,streamId:a.CONNECTION_STREAM_ID,type:a.FRAME_TYPES.KEEPALIVE}));t.send(n)}fireAndForget(e){this._machine.fireAndForget(e)}requestResponse(e){return this._machine.requestResponse(e)}requestStream(e){return this._machine.requestStream(e)}requestChannel(e){return this._machine.requestChannel(e)}metadataPush(e){return this._machine.metadataPush(e)}close(){this._machine.close()}connectionStatus(){return this._machine.connectionStatus()}_buildSetupFrame(e){const{dataMimeType:t,keepAlive:r,lifetime:n,metadataMimeType:s}=e.setup;return{data:void 0,dataMimeType:t,flags:0,keepAlive:r,lifetime:n,majorVersion:u.MAJOR_VERSION,metadata:void 0,metadataMimeType:s,minorVersion:u.MINOR_VERSION,resumeToken:null,streamId:a.CONNECTION_STREAM_ID,type:a.FRAME_TYPES.SETUP}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,s=r(12),i=(n=s)&&n.__esModule?n:{default:n};t.default=class{constructor(e,t){this._fn=t,this._subscriber=e,this._subscription=null}onComplete(){this._subscriber.onComplete()}onError(e){this._subscriber.onError(e)}onNext(e){try{this._subscriber.onNext(this._fn(e))}catch(e){(0,i.default)(this._subscription).cancel(),this._subscriber.onError(e)}}onSubscribe(e){this._subscription=e,this._subscriber.onSubscribe(e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,s=r(12),i=(n=s)&&n.__esModule?n:{default:n};t.default=class{constructor(e,t){this._subscriber=e,this._subscription=null,this._toTake=t}onComplete(){this._subscriber.onComplete()}onError(e){this._subscriber.onError(e)}onNext(e){try{this._subscriber.onNext(e),0==--this._toTake&&this._cancelAndComplete()}catch(e){(0,i.default)(this._subscription).cancel(),this._subscriber.onError(e)}}onSubscribe(e){this._subscription=e,this._subscriber.onSubscribe(e),this._toTake<=0&&this._cancelAndComplete()}_cancelAndComplete(){(0,i.default)(this._subscription).cancel(),this._subscriber.onComplete()}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(r(4)),s=i(r(5));function i(e){return e&&e.__esModule?e:{default:e}}class o{static of(e){return new o(t=>{t.onSubscribe(),t.onComplete(e)})}static error(e){return new o(t=>{t.onSubscribe(),t.onError(e)})}constructor(e){this._source=e}subscribe(e){const t=new a(e);try{this._source(t)}catch(e){t.onError(e)}}flatMap(e){return new o(t=>{let r;const n=()=>{r&&r(),r=null};this._source({onComplete:n=>{e(n).subscribe({onComplete:e=>{t.onComplete(e)},onError:e=>t.onError(e),onSubscribe:e=>{r=e}})},onError:e=>t.onError(e),onSubscribe:e=>{r=e,t.onSubscribe(n)}})})}map(e){return new o(t=>this._source({onComplete:r=>t.onComplete(e(r)),onError:e=>t.onError(e),onSubscribe:e=>t.onSubscribe(e)}))}then(e,t){this.subscribe({onComplete:e||s.default,onError:t||s.default})}}t.default=o;class a{constructor(e){this._active=!1,this._started=!1,this._subscriber=e||{}}onComplete(e){if(this._active){this._active=!1,this._started=!0;try{this._subscriber.onComplete&&this._subscriber.onComplete(e)}catch(e){this._subscriber.onError&&this._subscriber.onError(e)}}else(0,n.default)(!1,"Single: Invalid call to onComplete(): %s.",this._started?"onComplete/onError was already called":"onSubscribe has not been called")}onError(e){!this._started||this._active?(this._active=!1,this._started=!0,this._subscriber.onError&&this._subscriber.onError(e)):(0,n.default)(!1,"Single: Invalid call to onError(): %s.",this._active?"onComplete/onError was already called":"onSubscribe has not been called")}onSubscribe(e){if(this._started)(0,n.default)(!1,"Single: Invalid call to onSubscribe(): already called.");else{this._active=!0,this._started=!0;try{this._subscriber.onSubscribe&&this._subscriber.onSubscribe(()=>{this._active&&(this._active=!1,e&&e())})}catch(e){this.onError(e)}}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,s=r(4),i=(n=s)&&n.__esModule?n:{default:n};t.default=class{constructor(e,t){this._source=e,this._transformer=t,this._done=!1,this._mappers=[]}onSubscribe(e){this._subscription=e}onNext(e){if(!this._sink)return void(0,i.default)("Warning, premature onNext for processor, dropping value");let t=e;this._transformer&&(t=this._transformer(e));const r=this._mappers.reduce((e,t)=>t(e),t);this._sink.onNext(r)}onError(e){this._error=e,this._sink?this._sink.onError(e):(0,i.default)("Warning, premature onError for processor, marking complete/errored")}onComplete(){this._done=!0,this._sink?this._sink.onComplete():(0,i.default)("Warning, premature onError for processor, marking complete")}subscribe(e){this._source.subscribe&&this._source.subscribe(this),this._sink=e,this._sink.onSubscribe(this),this._error?this._sink.onError(this._error):this._done&&this._sink.onComplete()}map(e){return this._mappers.push(e),this}request(e){this._subscription&&this._subscription.request(e)}cancel(){this._subscription&&this._subscription.cancel()}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.every=function(e){return new i.default(t=>{let r=null,n=0;t.onSubscribe({cancel:()=>{null!=r&&(clearInterval(r),r=null)},request:s=>{s<Number.MAX_SAFE_INTEGER?n+=s:n=Number.MAX_SAFE_INTEGER,null==r&&(r=setInterval(()=>{n>0&&(n!==Number.MAX_SAFE_INTEGER&&n--,t.onNext(Date.now()))},e))}})})};var n,s=r(11),i=(n=s)&&n.__esModule?n:{default:n}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MAJOR_VERSION=1,t.MINOR_VERSION=0},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});r(3);var n,s=r(1),i=(n=s)&&n.__esModule?n:{default:n},o=r(2),a=r(7),u=r(13);t.default=class{constructor(e){this._handleTransportComplete=()=>{this._handleTransportError(new Error("RSocketServer: Connection closed unexpectedly."))},this._handleTransportError=e=>{this._connections.forEach(e=>{e.close()})},this._handleTransportConnection=e=>{const t=new c;let r;e.receive().subscribe(t.swap({onError:e=>console.error(e),onNext:r=>{switch(r.type){case o.FRAME_TYPES.RESUME:e.sendOne({code:o.ERROR_CODES.REJECTED_RESUME,flags:0,message:"RSocketServer: RESUME not supported.",streamId:o.CONNECTION_STREAM_ID,type:o.FRAME_TYPES.ERROR}),e.close();break;case o.FRAME_TYPES.SETUP:const n=this._getSerializers(),s=(0,u.createServerMachine)(e,e=>{t.swap(e)},n);try{const e=this._config.getRequestHandler(s,function(e,t){return{data:e.data.deserialize(t.data),metadata:e.metadata.deserialize(t.metadata)}}(n,r));s.setRequestHandler(e),this._connections.add(s)}catch(t){e.sendOne({code:o.ERROR_CODES.REJECTED_SETUP,flags:0,message:"Application rejected setup, reason: "+t.message,streamId:o.CONNECTION_STREAM_ID,type:o.FRAME_TYPES.ERROR}),e.close()}break;default:(0,i.default)(!1,"RSocketServer: Expected first frame to be SETUP or RESUME, got `%s`.",(0,o.getFrameTypeName)(r.type))}},onSubscribe:e=>{(r=e).request(1)}}))},this._config=e,this._connections=new Set,this._started=!1,this._subscription=null}start(){(0,i.default)(!this._started,"RSocketServer: Unexpected call to start(), already started."),this._started=!0,this._config.transport.start().subscribe({onComplete:this._handleTransportComplete,onError:this._handleTransportError,onNext:this._handleTransportConnection,onSubscribe:e=>{this._subscription=e,e.request(Number.MAX_SAFE_INTEGER)}})}stop(){this._subscription&&this._subscription.cancel(),this._config.transport.stop(),this._handleTransportError(new Error("RSocketServer: Connection terminated via stop()."))}_getSerializers(){return this._config.serializers||a.IdentitySerializers}};class c{constructor(e){this._target=e}swap(e){return this._target=e,this._subscription&&this._target.onSubscribe&&this._target.onSubscribe(this._subscription),this}onComplete(){(0,i.default)(this._target,"must have target"),this._target.onComplete&&this._target.onComplete()}onError(e){(0,i.default)(this._target,"must have target"),this._target.onError&&this._target.onError(e)}onNext(e){(0,i.default)(this._target,"must have target"),this._target.onNext&&this._target.onNext(e)}onSubscribe(e){(0,i.default)(this._target,"must have target"),this._subscription=e,this._target.onSubscribe&&this._target.onSubscribe(e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,s=r(3),i=r(1),o=(n=i)&&n.__esModule?n:{default:n},a=r(2),u=r(14);t.default=class{constructor(e,t){(0,o.default)(t.bufferSize>=0,"RSocketResumableTransport: bufferSize option must be >= 0, got `%s`.",t.bufferSize),this._bufferSize=t.bufferSize,this._position={client:0,server:0},this._currentConnection=null,this._statusSubscription=null,this._receiveSubscription=null,this._pendingFrames=[],this._receivers=new Set,this._resumeToken=t.resumeToken,this._senders=new Set,this._sentFrames=[],this._setupFrame=null,this._source=e,this._status=u.CONNECTION_STATUS.NOT_CONNECTED,this._statusSubscribers=new Set}close(){this._close()}connect(){(0,o.default)(!this._isTerminated(),"RSocketResumableTransport: Cannot connect(), connection terminated (%s).",this._status.kind);try{this._disconnect(),this._currentConnection=null,this._receiveSubscription=null,this._statusSubscription=null,this._setConnectionStatus(u.CONNECTION_STATUS.CONNECTING);const e=this._source();e.connectionStatus().subscribe({onNext:t=>{t.kind!==this._status.kind&&("CONNECTED"===t.kind?null==this._setupFrame?this._handleConnected(e):this._handleResume(e):(this._disconnect(),this._setConnectionStatus(u.CONNECTION_STATUS.NOT_CONNECTED)))},onSubscribe:e=>{this._statusSubscription=e,e.request(Number.MAX_SAFE_INTEGER)}}),e.connect()}catch(e){this._close(e)}}connectionStatus(){return new s.Flowable(e=>{e.onSubscribe({cancel:()=>{this._statusSubscribers.delete(e)},request:()=>{this._statusSubscribers.add(e),e.onNext(this._status)}})})}receive(){return new s.Flowable(e=>{e.onSubscribe({cancel:()=>{this._receivers.delete(e)},request:()=>{this._receivers.add(e)}})})}sendOne(e){try{this._writeFrame(e)}catch(e){this._close(e)}}send(e){let t;e.subscribe({onComplete:()=>{t&&this._senders.delete(t)},onError:e=>{t&&this._senders.delete(t),this._close(e)},onNext:e=>this._writeFrame(e),onSubscribe:e=>{t=e,this._senders.add(t),t.request(Number.MAX_SAFE_INTEGER)}})}_close(e){this._isTerminated()||(e?this._setConnectionStatus({error:e,kind:"ERROR"}):this._setConnectionStatus(u.CONNECTION_STATUS.CLOSED),this._disconnect())}_disconnect(){this._statusSubscription&&(this._statusSubscription.cancel(),this._statusSubscription=null),this._receiveSubscription&&(this._receiveSubscription.cancel(),this._receiveSubscription=null),this._currentConnection&&(this._currentConnection.close(),this._currentConnection=null)}_handleConnected(e){this._currentConnection=e,this._flushFrames(),this._setConnectionStatus(u.CONNECTION_STATUS.CONNECTED),e.receive().subscribe({onNext:e=>{try{this._receiveFrame(e)}catch(e){this._close(e)}},onSubscribe:e=>{this._receiveSubscription=e,e.request(Number.MAX_SAFE_INTEGER)}})}_handleResume(e){e.receive().take(1).subscribe({onNext:t=>{try{if(t.type===a.FRAME_TYPES.RESUME_OK){const{clientPosition:r}=t;if(r<this._position.client)return void this._close(new Error("RSocketResumableTransport: Resumption failed, server is missing frames that are no longer in the client buffer."));const n=this._sentFrames.slice(r-this._position.client);this._pendingFrames=[...n,...this._pendingFrames],this._sentFrames.length=r-this._position.client,this._handleConnected(e)}else{const e=t.type===a.FRAME_TYPES.ERROR?(0,a.createErrorFromFrame)(t):new Error("RSocketResumableTransport: Resumption failed for an unspecified reason.");this._close(e)}}catch(e){this._close(e)}},onSubscribe:e=>{this._receiveSubscription=e,e.request(1)}});const t=this._setupFrame;(0,o.default)(t,"RSocketResumableTransport: Cannot resume, setup frame has not been sent."),e.sendOne({clientPosition:this._position.client,flags:0,majorVersion:t.majorVersion,minorVersion:t.minorVersion,resumeToken:this._resumeToken,serverPosition:this._position.server,streamId:a.CONNECTION_STREAM_ID,type:a.FRAME_TYPES.RESUME})}_isTerminated(){return"CLOSED"===this._status.kind||"ERROR"===this._status.kind}_setConnectionStatus(e){e.kind!==this._status.kind&&(this._status=e,this._statusSubscribers.forEach(t=>t.onNext(e)))}_receiveFrame(e){(0,a.isResumePositionFrameType)(e.type)&&this._position.server++,this._receivers.forEach(t=>t.onNext(e))}_flushFrames(){for(;this._pendingFrames.length&&this._currentConnection;)this._writeFrame(this._pendingFrames.shift())}_writeFrame(e){e.type===a.FRAME_TYPES.SETUP&&((0,o.default)(e.majorVersion>1||1===e.majorVersion&&e.minorVersion>0,"RSocketResumableTransport: Unsupported protocol version %s.%s. This class implements the v1.1 resumption protocol.",e.majorVersion,e.minorVersion),e=Object.assign({},e,{flags:e.flags|a.FLAGS.RESUME_ENABLE,resumeToken:this._resumeToken}),this._setupFrame=e);const t=this._currentConnection;t?((0,a.isResumePositionFrameType)(e.type)&&(this._sentFrames.push(e),this._sentFrames.length>this._bufferSize&&(this._sentFrames.shift(),this._position.client++)),t.sendOne(e)):this._bufferSize>0?((0,o.default)(this._pendingFrames.length<this._bufferSize,"RSocketResumableTransport: Buffer size of `%s` exceeded.",this._bufferSize),this._pendingFrames.push(e)):(0,o.default)(!1,"RSocketResumableTransport: Cannot sent frames while disconnected; buffering is disabled (bufferSize === 0).")}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CONNECTION_STATUS={CLOSED:Object.freeze({kind:"CLOSED"}),CONNECTED:Object.freeze({kind:"CONNECTED"}),CONNECTING:Object.freeze({kind:"CONNECTING"}),NOT_CONNECTED:Object.freeze({kind:"NOT_CONNECTED"})}},function(e,t,r){},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,s=r(1),i=(n=s)&&n.__esModule?n:{default:n},o=r(3),a=r(0),u=r(14);t.default=class{constructor(e,t){this._handleClosed=e=>{this._close(new Error(e.reason||"RSocketWebSocketClient: Socket closed unexpectedly."))},this._handleError=e=>{this._close(e.error)},this._handleOpened=()=>{this._setConnectionStatus(u.CONNECTION_STATUS.CONNECTED)},this._handleMessage=e=>{try{const t=this._readFrame(e);this._receivers.forEach(e=>e.onNext(t))}catch(e){this._close(e)}},this._encoders=t,this._options=e,this._receivers=new Set,this._senders=new Set,this._socket=null,this._status=u.CONNECTION_STATUS.NOT_CONNECTED,this._statusSubscribers=new Set}close(){this._close()}connect(){(0,i.default)("NOT_CONNECTED"===this._status.kind,"RSocketWebSocketClient: Cannot connect(), a connection is already established."),this._setConnectionStatus(u.CONNECTION_STATUS.CONNECTING);const e=this._options.wsCreator,t=this._options.url;this._socket=e?e(t):new WebSocket(t);const r=this._socket;r.binaryType="arraybuffer",r.addEventListener("close",this._handleClosed),r.addEventListener("error",this._handleError),r.addEventListener("open",this._handleOpened),r.addEventListener("message",this._handleMessage)}connectionStatus(){return new o.Flowable(e=>{e.onSubscribe({cancel:()=>{this._statusSubscribers.delete(e)},request:()=>{this._statusSubscribers.add(e),e.onNext(this._status)}})})}receive(){return new o.Flowable(e=>{e.onSubscribe({cancel:()=>{this._receivers.delete(e)},request:()=>{this._receivers.add(e)}})})}sendOne(e){this._writeFrame(e)}send(e){let t;e.subscribe({onComplete:()=>{t&&this._senders.delete(t)},onError:e=>{t&&this._senders.delete(t),this._close(e)},onNext:e=>this._writeFrame(e),onSubscribe:e=>{t=e,this._senders.add(t),t.request(Number.MAX_SAFE_INTEGER)}})}_close(e){if("CLOSED"===this._status.kind||"ERROR"===this._status.kind)return;const t=e?{error:e,kind:"ERROR"}:u.CONNECTION_STATUS.CLOSED;this._setConnectionStatus(t),this._receivers.forEach(t=>{e?t.onError(e):t.onComplete()}),this._receivers.clear(),this._senders.forEach(e=>e.cancel()),this._senders.clear();const r=this._socket;r&&(r.removeEventListener("close",this._handleClosed),r.removeEventListener("error",this._handleClosed),r.removeEventListener("open",this._handleOpened),r.removeEventListener("message",this._handleMessage),r.close(),this._socket=null)}_setConnectionStatus(e){this._status=e,this._statusSubscribers.forEach(t=>t.onNext(e))}_readFrame(e){const t=(0,a.toBuffer)(e.data);return this._options.lengthPrefixedFrames?(0,a.deserializeFrameWithLength)(t,this._encoders):(0,a.deserializeFrame)(t,this._encoders)}_writeFrame(e){try{0;const t=this._options.lengthPrefixedFrames?(0,a.serializeFrameWithLength)(e,this._encoders):(0,a.serializeFrame)(e,this._encoders);(0,i.default)(this._socket,"RSocketWebSocketClient: Cannot send frame, not connected."),this._socket.send(t)}catch(e){this._close(e)}}}},function(e,t,r){"use strict";r.r(t);var n=r(0),s=r(15),i=r.n(s);class o{deserialize(e){return null==e?null:e.toString("utf8",1,e.length)}serialize(e){if(null==e)return null;let t=Object(n.byteLength)(e,"utf8"),r=Object(n.createBuffer)(1+t);return r.writeUInt8(t,0),r.write(e,1,e.length,"utf8"),r}}o.MIME_TYPE="message/x.rsocket.routing.v0",o.MIME_TYPE_ID=126;const a={data:n.UTF8Encoder,dataMimeType:n.UTF8Encoder,message:n.UTF8Encoder,metadata:n.BufferEncoder,metadataMimeType:n.UTF8Encoder,resumeToken:n.UTF8Encoder};class u{constructor(e){this.client=new n.RSocketClient({serializers:{data:n.JsonSerializer,metadata:new o},setup:{keepAlive:1e4,lifetime:2e4,dataMimeType:"application/json",metadataMimeType:o.MIME_TYPE},transport:new i.a({url:e},a)})}connect(e){return this.client.connect().subscribe({onComplete:t=>{this.socket=t,e()},onError:e=>console.error(e),onSubscribe:e=>{this.cancel=e}})}disconnect(){this.cancel()}getOffset(e){console.log("getoffset called"),this.socket.requestResponse({data:{},metadata:"getCurrentOffset"}).subscribe({onComplete:t=>{console.log("received: "+JSON.stringify(t)),e(t)},onError:t=>{console.error(t),e(t)},onSubscribe:e=>console.log("subscribed: "+e)})}send(e,t,r){console.log(e),this.socket.fireAndForget({data:{type:e,id:t,etag:r},metadata:"test"})}reqStream(e,t,r,n){console.log("requesting server response"),this.socket.requestStream({data:"input string",metadata:"getEvents"}).subscribe({onError:e=>{console.error(e),console.dir(e)},onNext:e=>{const t=e.data;console.log("stream provided next value"),console.log(t),n(t)},onSubscribe:e=>{console.log("subscribed Now setting up backpressure control "),console.log(e),window.setInterval(()=>{console.log("requesting next 10 "),e.request(10)},1e3)}})}}window.onload=function(){var e=new u("ws://localhost:8080/rsocket");e.connect(()=>{this.console.log("connected"),document.getElementById("offsetForm").onsubmit=t=>(console.log("submit done"),e.getOffset(e=>{document.getElementById("latestOffset").innerHTML=JSON.stringify(e)}),!1),document.getElementById("sendForm").onsubmit=t=>(console.log("send done"),e.send(t.srcElement.elements.TypeToSend.value,t.srcElement.elements.IdToSend.value,t.srcElement.elements.eTagToSend.value),!1),document.getElementById("streamForm").onsubmit=t=>(console.log("send done"),e.reqStream(t.srcElement.elements.TypeToSend.value,t.srcElement.elements.IdToSend.value,t.srcElement.elements.eTagToSend.value,e=>{const t=document.getElementById("messagelist"),r=document.createElement("LI");r.innerHTML=JSON.stringify(e),t.appendChild(r)}),!1)})}}]);